name: Extract ZIP Files
on:
  workflow_dispatch:
    inputs:
      zip_file:
        description: 'ZIP file name (e.g., tutorial.zip)'
        required: true
        default: 'tutorial.zip'
      target_folder:
        description: 'Target folder name (use "." for root)'
        required: true
        default: '.'
      branch:
        description: 'Target branch name'
        required: false
        default: ''

jobs:
  unzip:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          ref: ${{ inputs.branch || github.ref_name }}
      
      - name: Extract and commit ZIP contents
        run: |
          # Determine branch
          BRANCH="${{ inputs.branch }}"
          if [ -z "$BRANCH" ]; then
            BRANCH="${{ github.ref_name }}"
          fi
          echo "üåø Using branch: $BRANCH"
          
          # Check if ZIP file exists
          if [ ! -f "${{ inputs.zip_file }}" ]; then
            echo "‚ùå ZIP file ${{ inputs.zip_file }} not found!"
            exit 1
          fi
          
          # Handle extraction
          if [ "${{ inputs.target_folder }}" = "." ]; then
            echo "üì¶ Extracting ${{ inputs.zip_file }} to root directory..."
            unzip -o "${{ inputs.zip_file }}"
          else
            rm -rf "${{ inputs.target_folder }}"
            mkdir -p "${{ inputs.target_folder }}"
            echo "üì¶ Extracting ${{ inputs.zip_file }} to ${{ inputs.target_folder }}/..."
            unzip "${{ inputs.zip_file }}" -d "${{ inputs.target_folder }}/"
          fi
          
          # Remove ZIP file
          rm "${{ inputs.zip_file }}"
          
          # Configure git
          git config --local user.email "github-actions@users.noreply.github.com"
          git config --local user.name "github-actions"
          
          # Add and commit
          git add .
          git commit -m "Extract ${{ inputs.zip_file }} to ${{ inputs.target_folder }} on $BRANCH"
          
          # Push to branch
          git push origin $BRANCH
          
          echo "‚úÖ Successfully extracted to $BRANCH branch!"
